extends PopupPanel

func _ready():
	# Set modal styles
	setup_styles()

	# Find and validate required nodes
	var feed_content = $ScrollContainer/VBoxContainer/HBoxContainer/FeedContent
	if not feed_content:
		print("Error: FeedContent node not found!")
	else:
		print("FeedContent found.")

	# Connect close button functionality
	var close_button = $VBoxContainer/MarginContainer/HBoxContainerFM/CloseButton
	if close_button:
		close_button.pressed.connect(_on_close_button_pressed)
	else:
		print("Error: CloseButton node not found!")

	# Set up feed container
	setup_feed_container()

func setup_styles():
	# Style the main PopupPanel
	var style = StyleBoxFlat.new()
	style.bg_color = Color(0.2, 0.2, 0.2)  # Dark gray
	style.corner_radius_top_left = 10
	style.corner_radius_top_right = 10
	style.corner_radius_bottom_left = 10
	style.corner_radius_bottom_right = 10
	add_theme_stylebox_override("panel", style)

func setup_feed_container():
	var feed_container = $ScrollContainer/VBoxContainer/HBoxContainer
	if feed_container:
		# Add initial feed content
		add_new_update("Welcome to your feed!", 0)
	else:
		print("Error: Feed container node not found!")

func add_new_update(message: String, follower_change: int):
	var feed_content = $ScrollContainer/VBoxContainer/HBoxContainer/FeedContent
	if feed_content:
		var text = "[b]Feed Update![/b]\n"
		text += message + "\n\n"
		var color = "#FF4040" if follower_change < 0 else "#40FF40"
		text += "[color=" + color + "]" + str(follower_change) + " fans[/color]"
		feed_content.text = text
	else:
		print("Error: Cannot update feed. FeedContent node not found!")

func _on_close_button_pressed():
	hide()
